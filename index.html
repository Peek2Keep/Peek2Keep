<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ad Unlock Gallery</title>
<style>
body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #111;
}

/* Top Bar */
.top-bar {
    background: black;
    color: white;
    padding: 15px;
    font-size: 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

/* Favorites top icon */
.favorite-icon-top {
    cursor: pointer;
    font-size: 24px;
}

/* Gallery */
.gallery {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
    padding: 12px;
}

/* Card */
.card {
    background: #1c1c1c;
    border-radius: 12px;
    overflow: hidden;
}

/* Image */
.card img {
    width: 100%;
    height: 300px;
    object-fit: cover;
    cursor: pointer;
}

/* Bottom Info */
.bottom-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px;
    background: #000;
    font-size: 16px;
    font-weight: bold;
    color: #00ffcc;
}

/* Heart */
.heart {
    cursor: pointer;
    font-size: 20px;
}

.heart.active {
    color: red;
}

/* Popup */
.popup {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.9);
    justify-content: center;
    align-items: center;
    flex-direction: column;
    z-index: 1000;
}

.popup img {
    width: 95%;
    max-height: 80%;
    border-radius: 15px;
}

.popup-buttons {
    margin-top: 20px;
    display: flex;
    gap: 15px;
}

.save-btn, .cancel-btn {
    padding: 12px 25px;
    font-size: 16px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
}

.save-btn {
    background: #00ffcc;
}

.cancel-btn {
    background: red;
    color: white;
}

/* Favorites page */
.favorites-page {
    position: fixed;
    top: -100%;
    left: 0;
    width: 100%;
    height: 100%;
    background: #000;
    transition: 0.4s ease;
    z-index: 999;
    overflow-y: auto;
}

.favorites-page.active {
    top: 0;
}

.favorites-header {
    color: white;
    padding: 15px;
    font-size: 20px;
    display: flex;
    justify-content: space-between;
}

.favorites-gallery {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
    padding: 12px;
}

.favorites-gallery img {
    width: 100%;
    height: 250px;
    object-fit: cover;
    border-radius: 10px;
}

.close-fav {
    cursor: pointer;
}
</style>
</head>
<body>

<div class="top-bar">
    Unlock Images
    <span class="favorite-icon-top" onclick="openFavorites()">‚ù§Ô∏è</span>
</div>

<div class="gallery" id="gallery"></div>

<!-- Popup -->
<div class="popup" id="popup">
    <img id="popupImg">
    <div class="popup-buttons">
        <button class="save-btn" id="saveBtn">Save Image</button>
        <button class="cancel-btn" id="cancelBtn">Cancel</button>
    </div>
</div>

<!-- Favorites Page -->
<div class="favorites-page" id="favoritesPage">
    <div class="favorites-header">
        Your Favorites
        <span class="close-fav" onclick="closeFavorites()">‚úñ</span>
    </div>
    <div class="favorites-gallery" id="favoritesGallery"></div>
</div>

<script>
let favorites = [];
let galleryData = JSON.parse(localStorage.getItem('galleryData')) || [];
let currentCard = null;
let currentImage = null;

// Load gallery
function loadGallery() {
    const gallery = document.getElementById('gallery');
    gallery.innerHTML = '';
    galleryData.forEach((item, index) => {
        const card = document.createElement('div');
        card.className = 'card';
        card.setAttribute('data-original', item.ads);
        card.innerHTML = `
            <img src="${item.url}" data-adslink="${item.link}" onclick="handleClick(this)">
            <div class="bottom-info">
                <div>Ads Left: <span>${item.ads}</span></div>
                <div class="heart" onclick="toggleFavorite(this)">ü§ç</div>
            </div>
        `;
        gallery.appendChild(card);
    });
}

// Handle image click
function handleClick(imgElement) {
    const card = imgElement.closest(".card");
    const counterSpan = card.querySelector(".bottom-info span");
    let currentAds = parseInt(counterSpan.textContent);
    const adsLink = imgElement.getAttribute("data-adslink");

    if (currentAds > 0) {
        // Open the ads link in new tab
        window.open(adsLink, '_blank');
        currentAds--;
        counterSpan.textContent = currentAds;
    }

    if (currentAds === 0) {
        currentCard = card;
        currentImage = imgElement.src;
        showPopup(currentImage);
    }
}

// Show popup
function showPopup(src) {
    document.getElementById("popupImg").src = src;
    document.getElementById("popup").style.display = "flex";
}

// Save image
document.getElementById("saveBtn").onclick = function() {
    const link = document.createElement("a");
    link.href = currentImage;
    link.download = "image.jpg";
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    document.getElementById("popup").style.display = "none";
};

// Cancel popup -> reset ads
document.getElementById("cancelBtn").onclick = function() {
    if(currentCard){
        let confirmReset = confirm("Are you sure? The ads will reset.");
        if (confirmReset) {
            const counterSpan = currentCard.querySelector(".bottom-info span");
            const originalValue = currentCard.getAttribute("data-original");
            counterSpan.textContent = originalValue;
            currentCard.querySelector("img").src = currentImage; // restore image if needed
            document.getElementById("popup").style.display = "none";
        }
    }
};

// Toggle favorites
function toggleFavorite(heart) {
    const imgSrc = heart.closest(".card").querySelector("img").src;

    if (favorites.includes(imgSrc)) {
        favorites = favorites.filter(f => f !== imgSrc);
        heart.textContent = "ü§ç";
        heart.classList.remove("active");
    } else {
        favorites.push(imgSrc);
        heart.textContent = "‚ù§Ô∏è";
        heart.classList.add("active");
    }

    updateFavoritesPage();
}

// Update favorites gallery
function updateFavoritesPage() {
    const gallery = document.getElementById("favoritesGallery");
    gallery.innerHTML = '';
    favorites.forEach(src => {
        const img = document.createElement("img");
        img.src = src;
        gallery.appendChild(img);
    });
}

// Open / Close favorites
function openFavorites() {
    document.getElementById("favoritesPage").classList.add("active");
}

function closeFavorites() {
    document.getElementById("favoritesPage").classList.remove("active");
}

// Initial load
loadGallery();
</script>

</body>
</html>
